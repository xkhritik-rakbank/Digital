package com.newgen.iforms.user;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;

import org.json.simple.JSONArray;
import org.json.simple.JSONObject;

import com.newgen.iforms.custom.IFormReference;
import com.newgen.omni.jts.cmgr.XMLParser;
import com.sun.javafx.collections.MappingChange.Map;

public class Digital_CC_FormLoad extends Digital_CC_Common {

	String processInstanceID = "";
	String cabinetName = "";
	String sessionId = "";
	String serverIp = "";
	String serverPort = "";
	String oldSalaryDetails = "";

	public String formLoadEvent(IFormReference iform, String controlName, String event, String data) {
		this.processInstanceID = getWorkitemName(iform);
		this.cabinetName = getCabinetName(iform);
		this.sessionId = getSessionId(iform);
		this.serverIp = iform.getServerIp();
		this.serverPort = iform.getServerPort();
		String strReturn = "";

		Digital_CC.mLogger.debug("This is DCC_FormLoad_Event" + event + " controlName :" + controlName);

		String Workstep = iform.getActivityName();
		Digital_CC.mLogger.debug("WINAME : " + getWorkitemName(iform) + ", WSNAME: " + iform.getActivityName()
				+ ", Workstep :" + Workstep);

		// String FIRCO_Flag = (String) iform.getValue("FIRCO_Flag");
		String docType = (String) iform.getValue("AddnalDocs_doctype");
		String decision = (String) iform.getValue("Decision");
		String declineReason = (String) iform.getValue("Decline_reason");
		String overrideSalary = (String) iform.getValue("overrideIncomeFromDectech");
		String Prospect_Creation_Date = (String) iform.getValue("Prospect_Creation_Date");
		Digital_CC.mLogger.debug(" Prospect_Creation_Date on load" + Prospect_Creation_Date);
		String Selected_Card_Type = (String) iform.getValue("Selected_Card_Type");
		Digital_CC.mLogger.debug(" Selected_Card_Type on load" + Selected_Card_Type);
		String Prospect_id = (String) iform.getValue("Prospect_id");
		Digital_CC.mLogger.debug(" Prospect_id on load" + Prospect_id);
		String FirstName = (String) iform.getValue("FirstName");
		String MiddleName = (String) iform.getValue("MiddleName");
		String LastName = (String) iform.getValue("LastName");
		String CUSTOMERNAME = "";

		if (FirstName == null) {
			FirstName = "";
		}
		if (MiddleName == null) {
			MiddleName = "";
		}
		if (LastName == null) {
			LastName = "";
		}
		CUSTOMERNAME = FirstName + " " + MiddleName + " " + LastName;
		Digital_CC.mLogger.debug(" CUSTOMERNAME on load" + CUSTOMERNAME);

		String EMPLOYER_CODE = (String) iform.getValue("employercode");
		String COMPANY_STATUS_CC = (String) iform.getValue("CompanyStatusCC");
		String COMPANY_STATUS_PL = (String) iform.getValue("CompanyStatusPL");
		Digital_CC.mLogger.debug(" overrideSalary on load" + overrideSalary);
		Digital_CC.mLogger.debug(" COMPANY_STATUS_CC on load" + COMPANY_STATUS_CC);
		Digital_CC.mLogger.debug(" COMPANY_STATUS_PL on load" + COMPANY_STATUS_PL);

		if ("DecisionDropDown".equals(controlName)) {
			// added by gaurav
			try {
				List lstDecisions = iform
						.getDataFromDB("SELECT decision FROM NG_DCC_MASTER_DECISION WITH(NOLOCK) WHERE WorkstepName='"
								+ iform.getActivityName() + "' and Is_Active='Y' ORDER BY decision ASC");
				Digital_CC.mLogger.debug(" inside Decision drop down WS: " + lstDecisions);
				String value = "";
				iform.clearCombo("Decision");
				for (int i = 0; i < lstDecisions.size(); i++) {
					List<String> arr1 = (List) lstDecisions.get(i);
					value = arr1.get(0);
					iform.addItemInCombo("Decision", value, value);
					strReturn = "Decision Loaded";
				}

			} catch (Exception e) {
				Digital_CC.mLogger.debug("WINAME : " + getWorkitemName(iform) + ", WSNAME: " + iform.getActivityName()
						+ ", Exception in Decision drop down load " + e.getMessage());
			}

			try {
				List declineReasons = iform.getDataFromDB(
						"SELECT DeclineReason FROM ng_dcc_master_declineReason WITH(NOLOCK) WHERE WorkstepName='"
								+ iform.getActivityName() + "' and Is_Active='Y' ORDER BY DeclineReason ASC");
				Digital_CC.mLogger.debug(" inside Decline Reason drop down WS: " + declineReasons);
				String value = "";
				iform.clearCombo("Decline_reason");
				for (int i = 0; i < declineReasons.size(); i++) {
					List<String> arr1 = (List) declineReasons.get(i);
					value = arr1.get(0);
					iform.addItemInCombo("Decline_reason", value, value);

				}

			} catch (Exception e) {
				Digital_CC.mLogger.debug("WINAME : " + getWorkitemName(iform) + ", WSNAME: " + iform.getActivityName()
						+ ", Exception in Decline Reasons drop down load " + e.getMessage());
			}

		}

		else if ("AddnalDocs".equalsIgnoreCase(controlName)) {
			// added by gaurav 1708

			if (Workstep.equalsIgnoreCase("Firco")) {
				if (docType.equalsIgnoreCase("Other_Document")) {
					Digital_CC.mLogger.debug("docType : formLoad " + docType);
					iform.setStyle("AddnalDocs_remarks", "visible", "true");
					iform.setStyle("AddnalDocs_remarks", "mandatory", "true");

				} else {
					iform.setValue("AddnalDocs_remarks", "");
					iform.setStyle("AddnalDocs_remarks", "visible", "false");
					iform.setStyle("AddnalDocs_remarks", "mandatory", "false");
				}
			}
		}
		
		else if ("CustomerCallHistory".equalsIgnoreCase(controlName)) {
			// added by gaurav 2911

			if (Workstep.equalsIgnoreCase("DCC_Experience")) {
				iform.setValue("CustomerCallHistory_user", iform.getUserName());
				
			}
		}

		else if ("SuppDetailsGrid".equalsIgnoreCase(controlName)) {
			// added by gaurav 1808
			if (Workstep.equalsIgnoreCase("Card_Ops")) {
				iform.setStyle("SuppDetailsGrid_NameOnCard", "disable", "true");
				iform.setStyle("SuppDetailsGrid_FirstName", "disable", "true");
				iform.setStyle("SuppDetailsGrid_MiddleName", "disable", "true");
				iform.setStyle("SuppDetailsGrid_LastName", "disable", "true");
				iform.setStyle("SuppDetailsGrid_CardReqFor", "visible", "false");
				iform.setStyle("SuppDetailsGrid_RelationType", "visible", "false");
				iform.setStyle("SuppDetailsGrid_UAEResidency", "visible", "false");
				iform.setStyle("SuppDetailsGrid_DOB", "visible", "false");
				iform.setStyle("SuppDetailsGrid_PassportNum", "visible", "false");
				iform.setStyle("SuppDetailsGrid_PassportExp", "visible", "false");
				iform.setStyle("SuppDetailsGrid_Nationality", "visible", "false");
				iform.setStyle("SuppDetailsGrid_NationalityDesc", "visible", "false");
				iform.setStyle("SuppDetailsGrid_MobNo", "visible", "false");
				iform.setStyle("SuppDetailsGrid_Email", "visible", "false");
				iform.setStyle("SuppDetailsGrid_LimitReq", "visible", "false");
				iform.setStyle("SuppDetailsGrid_EID", "visible", "false");
				iform.setStyle("SuppDetailsGrid_EIDexp", "visible", "false");
				iform.setStyle("SuppDetailsGrid_visaNum", "visible", "false");
				iform.setStyle("SuppDetailsGrid_visaExp", "visible", "false");
				iform.setStyle("SuppDetailsGrid_Gender", "visible", "false");
				iform.setStyle("SuppDetailsGrid_GenderDesc", "visible", "false");
				iform.setStyle("SuppDetailsGrid_MotherName", "visible", "false");
				iform.setStyle("SuppDetailsGrid_MaritalStatus", "visible", "false");
				iform.setStyle("SuppDetailsGrid_Profession", "visible", "false");
				iform.setStyle("SuppDetailsGrid_EmpType", "visible", "false");
				iform.setStyle("SuppDetailsGrid_EmpTypeDesc", "visible", "false");
				iform.setStyle("SuppDetailsGrid_CIF_Title", "visible", "false");
				iform.setStyle("SuppDetailsGrid_CIF_TitleDesc", "visible", "false");
				iform.setStyle("SuppDetailsGrid_CIF", "visible", "false");
			}
		}

		else if ("onLoadEnableDisable".equalsIgnoreCase(controlName)) {
			// ENC Reference
			if (!(Prospect_id == null || "".equalsIgnoreCase(Prospect_id))) {
				iform.setValue("textbox214", Prospect_id);
			}
			// AECB Pipeline grid validation
			try {
				if(iform.getDataFromGrid("AECB_Pipeline_Grid").size()>0)
					iform.clearTable("AECB_Pipeline_Grid");
				String DBQuery4 = "select CifId, AgreementId,ProviderNo,LoanType,LoanDesc,CustRoleType,Datelastupdated,TotalAmt,TotalNoOfInstalments,CreditLimit,'' as col1,NoOfDaysInPipeline,"
						+ "isnull(Consider_For_Obligations,'true') as 'Consider_For_Obligations', case when IsDuplicate= '1' then 'Y' else 'N' end as 'IsDuplicate',case when WriteoffStat= 'W' then  OutstandingAmt else '' end as 'OutstandingAmt' from ng_dcc_cust_extexpo_LoanDetails with (nolock) "
						+ "where Wi_Name  =  '" + processInstanceID + "' and LoanStat = 'Pipeline' and ProviderNo !='B01' "
						+ "union select CifId, CardEmbossNum,ProviderNo,CardType,CardTypeDesc, CustRoleType,LastUpdateDate,'' as col2,NoOfInstallments, '' as col3, TotalAmount, "
						+ "NoOfDaysInPipeLine,isnull(Consider_For_Obligations,'true') as 'Consider_For_Obligations',case when IsDuplicate= '1' then 'Y' else 'N' end as 'IsDuplicate','' as 'OutstandingAmt'  from ng_dcc_cust_extexpo_CardDetails "
						+ "with (nolock) where Wi_Name  =  '" + processInstanceID + "' and cardstatus = 'Pipeline' and ProviderNo !='B01'";
				List<List<String>> twoDarray = iform.getDataFromDB(DBQuery4);
				Digital_CC.mLogger.debug("twoDarray: " + twoDarray);
				if (!twoDarray.isEmpty()) {
					JSONArray jsonArray = new JSONArray();
					JSONArray jsonArray1 = new JSONArray();
					

					iform.clearTable("AECB_Pipeline_Grid");
					for (int i = 0; i < twoDarray.size(); i++) {
						JSONObject obj1 = new JSONObject();
						String typeOfContract_LoanType = twoDarray.get(i).get(3);
						Digital_CC.mLogger.debug("Reason_Code : " + typeOfContract_LoanType);

						String provider_No = twoDarray.get(i).get(2);
						Digital_CC.mLogger.debug("Reason_Code : " + provider_No);

						String phasE = "PIPELINE";
						Digital_CC.mLogger.debug("Reason_Code : " + phasE);

						String loanType = twoDarray.get(i).get(3);
						String financeAmt = "";
						if (loanType.toUpperCase().contains("LOAN")) {
							financeAmt += twoDarray.get(i).get(7);
						} else {
							financeAmt += twoDarray.get(i).get(10);
						}
						Digital_CC.mLogger.debug("financeAmt : " + financeAmt);

						String RequestDate = twoDarray.get(i).get(6);
						Digital_CC.mLogger.debug("RequestDate : " + RequestDate);
						
						

						obj1.put("Type of Contract", typeOfContract_LoanType);
						obj1.put("Provider No", provider_No);
						obj1.put("Phase", phasE);
						obj1.put("Finance Amount", financeAmt);
						obj1.put("Request Date", RequestDate);
						

						if (jsonArray.contains(obj1)) {
							continue;
						}

						jsonArray.add(obj1);
					}

					Digital_CC.mLogger.debug("jsonArray : " + jsonArray);
					iform.addDataToGrid("AECB_Pipeline_Grid", jsonArray);
					
					/*for (int i = 0; i < twoDarray.size(); i++) {
						JSONObject obj1 = new JSONObject();

						String extChargeoff = twoDarray.get(i).get(14);
						Digital_CC.mLogger.debug("extChargeoff : " + extChargeoff);

						obj1.put("External Charge Off", extChargeoff);

						if (jsonArray1.contains(obj1)) {
							continue;
						}

						jsonArray1.add(obj1);
					}

					Digital_CC.mLogger.debug("jsonArray : " + jsonArray1);
					iform.addDataToGrid("DCC_AECB_Exposure_Grid", jsonArray1);*/

					for (int i = 0; i < twoDarray.size(); i++) {

						String extChargeoff = twoDarray.get(i).get(14);
						Digital_CC.mLogger.debug("extChargeoff : " + extChargeoff);
						
						if(!(extChargeoff == null || "".equalsIgnoreCase(extChargeoff))){
						iform.setTableCellValue("DCC_AECB_Exposure_Grid", i, 7, extChargeoff);
						}
					}
				}
			} catch (Exception e) {
				Digital_CC.mLogger.debug("Exception occured in fetching AECB Pipeline grid values: " + e.getMessage());
			}
			// AECB Exposure free fields
			try {
				/*String DBQuery1 = "SELECT Outstanding_Amount FROM ng_dcc_cust_external_exposure with(nolock) WHERE WI_NAME='"
						+ processInstanceID + "'";
				String extTabDataINPXML1 = Digital_CC_Common.apSelectWithColumnNames(DBQuery1, getCabinetName(iform),
						getSessionId(iform));
				Digital_CC.mLogger.debug("extTabDataIPXML: " + extTabDataINPXML1);
				String extTabDataOUPXML1 = Digital_CC_Common.WFNGExecute(extTabDataINPXML1, iform.getServerIp(),
						iform.getServerPort(), 1);
				Digital_CC.mLogger.debug("extTabDataOPXML: " + extTabDataOUPXML1);

				XMLParser xmlParserDataDB1 = new XMLParser(extTabDataOUPXML1);
				String Outstanding_Amount = xmlParserDataDB1.getValueOf("Outstanding_Amount");*/

				String DBQuery2 = "SELECT Worst_Status_Last24Months,NoOf_Cheque_Return_Last3,Nof_DDES_Return_Last3Months FROM ng_dcc_cust_extexpo_Derived with(nolock) WHERE WI_NAME='"
						+ processInstanceID + "'";
				String extTabDataINPXML2 = Digital_CC_Common.apSelectWithColumnNames(DBQuery2, getCabinetName(iform),
						getSessionId(iform));
				Digital_CC.mLogger.debug("extTabDataIPXML: " + extTabDataINPXML2);
				String extTabDataOUPXML2 = Digital_CC_Common.WFNGExecute(extTabDataINPXML2, iform.getServerIp(),
						iform.getServerPort(), 1);
				Digital_CC.mLogger.debug("extTabDataOPXML: " + extTabDataOUPXML2);

				XMLParser xmlParserDataDB2 = new XMLParser(extTabDataOUPXML2);
				String Worst_Status_Last24Months = xmlParserDataDB2.getValueOf("Worst_Status_Last24Months");
				String NoOf_Cheque_Return_Last3 = xmlParserDataDB2.getValueOf("NoOf_Cheque_Return_Last3");
				String Nof_DDES_Return_Last3Months = xmlParserDataDB2.getValueOf("Nof_DDES_Return_Last3Months");

				/*String DBQuery3 = "SELECT AECBHistMonthCnt,WriteoffStat FROM ng_dcc_cust_extexpo_LoanDetails with(nolock) WHERE WI_NAME='"
						+ processInstanceID + "'";
				String extTabDataINPXML3 = Digital_CC_Common.apSelectWithColumnNames(DBQuery3, getCabinetName(iform),
						getSessionId(iform));
				Digital_CC.mLogger.debug("extTabDataIPXML: " + extTabDataINPXML3);
				String extTabDataOUPXML3 = Digital_CC_Common.WFNGExecute(extTabDataINPXML3, iform.getServerIp(),
						iform.getServerPort(), 1);
				Digital_CC.mLogger.debug("extTabDataOPXML: " + extTabDataOUPXML3);

				XMLParser xmlParserDataDB3 = new XMLParser(extTabDataOUPXML3);
				String AECBHistMonthCnt = xmlParserDataDB3.getValueOf("AECBHistMonthCnt");
				String WriteoffStat = xmlParserDataDB3.getValueOf("WriteoffStat");*/

				// AECBHistMonthCnt
				/*Digital_CC.mLogger.debug(" AECBHistMonthCnt on load" + AECBHistMonthCnt);
				if (!(AECBHistMonthCnt == null || "".equalsIgnoreCase(AECBHistMonthCnt))) {
					iform.setValue("AECB_history", AECBHistMonthCnt);
					Digital_CC.mLogger.debug("AECBHistMonthCnt: " + AECBHistMonthCnt);
				}*/

				// Worst_Status_Last24Months
				Digital_CC.mLogger.debug(" Worst_Status_Last24Months on load" + Worst_Status_Last24Months);
				if (!(Worst_Status_Last24Months == null || "".equalsIgnoreCase(Worst_Status_Last24Months))) {
					iform.setValue("wrost_status_date", Worst_Status_Last24Months);
					Digital_CC.mLogger.debug("Worst_Status_Last24Months: " + Worst_Status_Last24Months);
				}

				// NoOf_Cheque_Return_Last3
				String NoOf_Return_Last3 = "";
				if (!(NoOf_Cheque_Return_Last3 == null || "".equalsIgnoreCase(NoOf_Cheque_Return_Last3))) {
					NoOf_Return_Last3 = NoOf_Return_Last3 + NoOf_Cheque_Return_Last3;
					if (!(Nof_DDES_Return_Last3Months == null || "".equalsIgnoreCase(Nof_DDES_Return_Last3Months))) {
						NoOf_Return_Last3 = NoOf_Return_Last3 + "," + Nof_DDES_Return_Last3Months;
						Digital_CC.mLogger.debug(" NoOf_Return_Last3 on load" + NoOf_Return_Last3);
					}
				}
				if (!(NoOf_Return_Last3 == null || "".equalsIgnoreCase(NoOf_Return_Last3))) {
					iform.setValue("cheque_dds_return", NoOf_Return_Last3);
					Digital_CC.mLogger.debug("NoOf_Return_Last3: " + NoOf_Return_Last3);
				}

				// WriteoffStat, externalChargeOff
				/*if (WriteoffStat.equalsIgnoreCase("W")) {
					if (!(Outstanding_Amount == null || "".equalsIgnoreCase(Outstanding_Amount))) {
						iform.setValue("external_charge_of", Outstanding_Amount);
						Digital_CC.mLogger.debug("Outstanding_Amount: " + Outstanding_Amount);
					}
				}*/

			} catch (Exception e) {
				Digital_CC.mLogger.debug("Exception occured in fetching AECB Exposure free fields: " + e.getMessage());
			}

			// non stp reason
			String Non_STP_reason = (String) iform.getValue("Non_STP_reason");
			Digital_CC.mLogger.debug(" Non_STP_reason on load" + Non_STP_reason);
			if (!(Non_STP_reason == null || "".equalsIgnoreCase(Non_STP_reason))) {
				if (Non_STP_reason.contains("~")) {
					Non_STP_reason = Non_STP_reason.replace("~", ",");
				}
				iform.setValue("Non_STP_reason", Non_STP_reason);
				Digital_CC.mLogger.debug(" Non_STP_reason on load after replacing ~ " + Non_STP_reason);
			}
			// Decision and Remarks
			if (Workstep.equalsIgnoreCase("System_Integration") || Workstep.equalsIgnoreCase("Sys_Int_EFMS")
					|| Workstep.equalsIgnoreCase("Sys_FTS_WI_Update") || Workstep.equalsIgnoreCase("Sys_DEH_Notify")
					|| Workstep.equalsIgnoreCase("Sys_Couried_WI_Update") || Workstep.equalsIgnoreCase("System_Wi_hold")
					|| Workstep.equalsIgnoreCase("Sys_PrimeAWB_Gen") || Workstep.equalsIgnoreCase("Sys_CardBalClsBlk")
					|| Workstep.equalsIgnoreCase("Exit") || Workstep.equalsIgnoreCase("Reject")
					|| Workstep.equalsIgnoreCase("Doc_Reverify") || Workstep.equalsIgnoreCase("Attach_Document")
					|| Workstep.equalsIgnoreCase("Sys_Update_Asign_CIF")
					|| Workstep.equalsIgnoreCase("Sys_Update_Asign_CIF") || Workstep.equalsIgnoreCase("Sys_WI_Update")
					|| Workstep.equalsIgnoreCase("Sys_CP_WI_Update")
					|| Workstep.equalsIgnoreCase("Sys_Limit_Increase")) {
				iform.setStyle("Decision", "disable", "true");
				iform.setStyle("Remarks", "disable", "true");
			}
			// for dectech button visibility
			if ("Exceptions".equalsIgnoreCase(Workstep.trim())) {
				iform.setStyle("Fetch_Manual_Dectech", "disable", "false");
			} else {
				iform.setStyle("Fetch_Manual_Dectech", "disable", "true");
			}
			// for aecb button visibility
			if ("Exceptions".equalsIgnoreCase(Workstep.trim()) || Workstep.equalsIgnoreCase("Sys_Couried_WI_Update")
					|| Workstep.equalsIgnoreCase("Sys_PrimeAWB_Gen") || Workstep.equalsIgnoreCase("Sys_CardBalClsBlk")
					|| Workstep.equalsIgnoreCase("Sys_Update_Asign_CIF")
					|| Workstep.equalsIgnoreCase("Sys_Update_Asign_CIF")
					|| Workstep.equalsIgnoreCase("Sys_CP_WI_Update") || Workstep.equalsIgnoreCase("Card_Ops")
					|| Workstep.equalsIgnoreCase("Sys_Limit_Increase")) {
				// dectech and aecb button
				// iform.setStyle("Fetch_Manual_Dectech", "visible", "true");
				iform.setStyle("Fetch_AECB_Report", "disable", "false");
			} else {
				iform.setStyle("Fetch_AECB_Report", "disable", "true");
			}

			// Old Salary Details added to table
			try {

				List<List<String>> twoDarray = iform.getDataFromDB(
						"select count(net_salary1) as rowCountOldSalary from NG_DCC_GR_NetSalaryDetails with (NOLOCK)  where Wi_Name ='"
								+ processInstanceID + "'");
				Digital_CC.mLogger.debug("twoDarray: " + twoDarray);
				String rowCountOldSalary = twoDarray.get(0).get(0);
				Digital_CC.mLogger.debug("rowCountOldSalary: " + rowCountOldSalary);
				if (rowCountOldSalary.equalsIgnoreCase("0")) {

					String Query_Old_Salary = "select net_salary1,net_salary2,net_salary3 from NG_DCC_EXTTABLE with (NOLOCK)  where Wi_Name ='"
							+ processInstanceID + "'";
					Digital_CC.mLogger.debug("Query_Old_Salary : " + Query_Old_Salary);
					String extTabDataIPXML = Digital_CC_Common.apSelectWithColumnNames(Query_Old_Salary, cabinetName,
							sessionId);
					Digital_CC.mLogger.debug("extTabDataIPXML: " + extTabDataIPXML);
					String extTabDataOPXML = Digital_CC_Common.WFNGExecute(extTabDataIPXML, serverIp, serverPort, 1);
					Digital_CC.mLogger.debug("extTabDataOPXML2: " + extTabDataOPXML);

					XMLParser xmlParserData = new XMLParser(extTabDataOPXML);

					String net_salary1 = xmlParserData.getValueOf("net_salary1");
					Digital_CC.mLogger.debug("net_salary1: " + net_salary1);

					String net_salary2 = xmlParserData.getValueOf("net_salary2");
					Digital_CC.mLogger.debug("net_salary2: " + net_salary2);

					String net_salary3 = xmlParserData.getValueOf("net_salary3");
					Digital_CC.mLogger.debug("net_salary3: " + net_salary3);

					if ((net_salary1 != null && !"".equalsIgnoreCase(net_salary1))
							|| (net_salary2 != null && !"".equalsIgnoreCase(net_salary2))
							|| (net_salary3 != null && !"".equalsIgnoreCase(net_salary3))) {

						String columnNames = "Net_Salary1,Net_Salary2,Wi_Name,Net_Salary3";
						String columnValues = "'" + net_salary1 + "','" + net_salary2 + "','" + processInstanceID
								+ "','" + net_salary3 + "'";

						String apInsertInputXML = Digital_CC_Common.apInsert(cabinetName, sessionId, columnNames,
								columnValues, "NG_DCC_GR_NetSalaryDetails");
						Digital_CC.mLogger.debug("APInsertInputXML: " + apInsertInputXML);

						String apInsertOutputXML = Digital_CC_Common.WFNGExecute(apInsertInputXML, serverIp, serverPort,
								1);
						Digital_CC.mLogger.debug("APInsertOutputXML: " + apInsertInputXML);

						XMLParser xmlParserAPInsert = new XMLParser(apInsertOutputXML);
						String apInsertMaincode = xmlParserAPInsert.getValueOf("MainCode");
						Digital_CC.mLogger.debug("Status of apInsertMaincode  " + apInsertMaincode);

						if (apInsertMaincode.equalsIgnoreCase("0")) {
							Digital_CC.mLogger.debug("ApInsert successful: " + apInsertMaincode);
						} else {
							Digital_CC.mLogger.debug("ApInsert failed: " + apInsertMaincode);
						}
					}
				}

			} catch (Exception ex) {
				Digital_CC.mLogger.debug("Exception " + ex);
			}
			// Income at rule engine
			String FinalTAI = (String) iform.getValue("FinalTAI");
			Digital_CC.mLogger.debug(" FinalTAI on load" + FinalTAI);
			if (!(FinalTAI == null || "".equalsIgnoreCase(FinalTAI))) {
				iform.setValue("INCOME_AT_RULE_ENGINE", FinalTAI);
			}
			// Remarks
			iform.setValue("Remarks", "");
			// customer Name
			String cust_name = (String) iform.getValue("CUSTOMERNAME");
			if (cust_name == null || "".equalsIgnoreCase(cust_name)) {
				iform.setValue("CUSTOMERNAME", CUSTOMERNAME);
			}
			// card application date
			if (!(Prospect_Creation_Date == null || "".equalsIgnoreCase(Prospect_Creation_Date))) {
				iform.setValue("card_application_date", Prospect_Creation_Date);
			}
			// Applied_card
			if (!(Selected_Card_Type == null || "".equalsIgnoreCase(Selected_Card_Type))) {
				iform.setValue("Applied_card", Selected_Card_Type);
			}
			iform.setStyle("Decision", "disable", "false");
			iform.setStyle("Decision", "mandatory", "true");
			iform.setStyle("Remarks", "disable", "false");
			if ("Exceptions".equalsIgnoreCase(Workstep.trim()) && decision.equalsIgnoreCase("Reject")) {
				iform.setStyle("Decline_reason", "visible", "true");
				iform.setStyle("Decline_reason", "disable", "false");
				iform.setStyle("Decline_reason", "mandatory", "true");
			} else {
				iform.setStyle("Decline_reason", "visible", "false");
				iform.setStyle("Decline_reason", "disable", "true");
				iform.setStyle("Decline_reason", "mandatory", "false");

			}
			if (declineReason.equalsIgnoreCase("Others")) {
				iform.setStyle("Remarks", "mandatory", "true");
			} else {
				iform.setStyle("Remarks", "mandatory", "false");
			}
			// Aloc Dtls table data
			if (COMPANY_STATUS_CC == null || COMPANY_STATUS_CC == "" || COMPANY_STATUS_PL == null
					|| COMPANY_STATUS_PL == "") {
				String query = "select COMPANY_STATUS_CC,COMPANY_STATUS_PL, EMPLOYER_CATEGORY_PL, ALOC_REMARKS_CC, ALOC_REMARKS_PL from NG_RLOS_ALOC_OFFLINE_DATA WITH(nolock) where EMPLOYER_CODE=main_Employer_code and main_Employer_code = '"
						+ EMPLOYER_CODE + "'";
				List<List<String>> AlocDetails = iform.getDataFromDB(query);
				Digital_CC.mLogger.debug(" inside AlocDetails arraylist: " + AlocDetails);
				if (!AlocDetails.isEmpty()) {
					COMPANY_STATUS_CC = AlocDetails.get(0).get(0);
					Digital_CC.mLogger.debug(" inside AlocDetails arraylist COMPANY_STATUS_CC: " + COMPANY_STATUS_CC);
					iform.setValue("CompanyStatusCC", COMPANY_STATUS_CC);
					COMPANY_STATUS_PL = AlocDetails.get(0).get(1);
					iform.setValue("CompanyStatusPL", COMPANY_STATUS_PL);
					String EMPLOYER_CATEGORY_PL = AlocDetails.get(0).get(2);
					iform.setValue("EmployerCategoryPL", EMPLOYER_CATEGORY_PL);
					String ALOC_REMARKS_CC = AlocDetails.get(0).get(3);
					iform.setValue("CC_ALOC_remarks", ALOC_REMARKS_CC);
					String ALOC_REMARKS_PL = AlocDetails.get(0).get(4);
					iform.setValue("PL_ALOC_remarks", ALOC_REMARKS_PL);
				}
			}
			// 1708 added by gaurav override_netSalary
			iform.setValue("overrideIncomeFromDectech", "false");
			if ("Exceptions".equalsIgnoreCase(Workstep.trim())) {
				Digital_CC.mLogger.debug(" inside form load exceptions-: " + Workstep);
				// sections
				iform.setStyle("DCC_PersonalDetails", "visible", "false");
				iform.setStyle("DCC_SuppCardDetails", "visible", "false");
				iform.setStyle("DCC_LiabilityAddition", "visible", "false");
				iform.setStyle("Additional_Documents_Required", "visible", "false");
				iform.setStyle("DocTypeSection", "visible", "false");
				// free field
				iform.setStyle("overrideIncomeFromDectech", "disable", "false");
				iform.setStyle("EnsureDelegationCheck", "visible", "true");
				iform.setStyle("EnsureDelegationCheck", "disable", "false");
				iform.setStyle("Old_Salary", "disable", "false");
				iform.setStyle("button6", "disable", "false");
				// GenerateCam button at cad
				iform.setStyle("GenerateCam", "visible", "true");
				iform.setStyle("GenerateCam", "disable", "false");
				//added by om on 19/10/22
				iform.setStyle("Final_Limit", "visible", "true");
			}

			else if (Workstep.equalsIgnoreCase("System_Integration") || Workstep.equalsIgnoreCase("Sys_Int_EFMS")
					|| Workstep.equalsIgnoreCase("Sys_FTS_WI_Update") || Workstep.equalsIgnoreCase("Sys_DEH_Notify")
					|| Workstep.equalsIgnoreCase("Sys_Error_Handling")
					|| Workstep.equalsIgnoreCase("Sys_Couried_WI_Update") || Workstep.equalsIgnoreCase("System_Wi_hold")
					|| Workstep.equalsIgnoreCase("Sys_PrimeAWB_Gen") || Workstep.equalsIgnoreCase("Sys_CardBalClsBlk")
					|| Workstep.equalsIgnoreCase("Exit") || Workstep.equalsIgnoreCase("Reject")
					|| Workstep.equalsIgnoreCase("Doc_Reverify") || Workstep.equalsIgnoreCase("Attach_Document")
					|| Workstep.equalsIgnoreCase("Sys_Update_Asign_CIF")
					|| Workstep.equalsIgnoreCase("Sys_Update_Asign_CIF") || Workstep.equalsIgnoreCase("Sys_WI_Update")
					|| Workstep.equalsIgnoreCase("Sys_CP_WI_Update")
					|| Workstep.equalsIgnoreCase("Sys_Limit_Increase")) {
				// sections
				iform.setStyle("DCC_PersonalDetails", "visible", "false");
				iform.setStyle("DCC_SuppCardDetails", "visible", "false");
				iform.setStyle("DCC_LiabilityAddition", "visible", "false");
				iform.setStyle("Additional_Documents_Required", "visible", "false");
				iform.setStyle("DocTypeSection", "visible", "false");
			}
			//added by gaurav 2911
			else if (Workstep.equalsIgnoreCase("Card_Ops")) {
				if (decision.equalsIgnoreCase("Reschedule")) {
					iform.setStyle("DocTypeSection", "visible", "true");
				} else {
					iform.setStyle("DocTypeSection", "visible", "false");
				}
				// generated document list
				List<List<String>> twoDarray2 = iform.getDataFromDB(
						"select genrateddocumentlist from NG_DCC_EXTTABLE with (NOLOCK)  where Wi_Name ='"
								+ processInstanceID + "'");
				Digital_CC.mLogger.debug("twoDarray2: " + twoDarray2);
				String genratedDocList = twoDarray2.get(0).get(0).replaceAll(",", "\n");
				Digital_CC.mLogger.debug("genratedDocList: " + genratedDocList);
				if (!(genratedDocList == null || "".equalsIgnoreCase(genratedDocList))) {
					iform.setValue("textarea19", genratedDocList);
				}
				//added by Om on 16/12/2022
				
					List docReschueledlist = iform.getDataFromDB(
							"select DISTINCT(name) from pdbdocument where DocumentIndex in (select DocumentIndex from PDBDocumentContent where ParentFolderIndex = (select itemindex from ng_dcc_exttable where Wi_Name='"+ processInstanceID + "')) "+
							" AND name in ('W8','W9','MRBH_Agency_Agreement','Customer_Consent_Form_Islamic-Arabic','Customer_Consent_Form_Islamic-English','W-9_Form','W-8_Form','Security_Cheque','Customer_Consent_Form')");
					
					Digital_CC.mLogger.debug(" inside Reschedule Doc list : " + docReschueledlist);
					String value = "";
					iform.clearCombo("DocumentTypeReq");
					for (int i = 0; i < docReschueledlist.size(); i++) {
						List<String> arr1 = (List) docReschueledlist.get(i);
						value = arr1.get(0);
						iform.addItemInCombo("Q_GR_DocumentName", value, value);
						strReturn = "Document Loaded";
					}

					//till here
				
				
				
				// added by gaurav
				// sections
				iform.setStyle("DCC_PersonalDetails", "visible", "false");
				iform.setStyle("DCC_EmploymentDetails", "visible", "false");
				iform.setStyle("DCC_BankingDetails", "visible", "false");
				iform.setStyle("DCC_RunPolicy", "visible", "false");
				iform.setStyle("DCC_SuppCardDetails", "visible", "false");
				iform.setStyle("Additional_Documents_Required", "visible", "false");
				iform.setStyle("DCC_AECB_Exposure", "visible", "false");
				iform.setStyle("DCC_LiabilityAddition", "visible", "false");
				iform.setStyle("DCC_AECBPipelines", "visible", "false");
				iform.setStyle("DCC_AdditionofChecque", "visible", "false");
				// free fields
				iform.setStyle("Final_Limit", "visible", "true");
				iform.setStyle("Virtual_Card_Limit", "visible", "true");
				iform.setStyle("Card_Number", "visible", "true");
				iform.setStyle("ECRN", "visible", "true");
				iform.setStyle("CRN", "visible", "true");
				iform.setStyle("Dectech_Decision", "visible", "false");
				iform.setStyle("delegation_authority", "visible", "false");
				iform.setStyle("Non_STP_reason", "visible", "false");
				iform.setStyle("Aecb_score", "visible", "false");
				iform.setStyle("Score_range", "visible", "false");
				iform.setStyle("deviation_description", "visible", "false");
				iform.setStyle("Underwriting_decision", "visible", "false");
				iform.setStyle("bureau_reference_number", "visible", "false");
				iform.setStyle("Expense1", "visible", "false");
				iform.setStyle("Expense2", "visible", "false");
				iform.setStyle("Expense3", "visible", "false");
				iform.setStyle("Expense4", "visible", "false");
				iform.setStyle("Expense5", "visible", "false");
				iform.setStyle("Expense6", "visible", "false");
				iform.setStyle("Credit_Shield_Flag", "visible", "false");
				iform.setStyle("RAK_Protect_Flag", "visible", "false");
				iform.setStyle("Self_Supp_Card_Limit", "visible", "false");
				iform.setStyle("Dependents", "visible", "false");
				iform.setStyle("RM_Code", "visible", "true");
				iform.setStyle("textarea19", "visible", "true");
				// Supp Card Details Grid
				iform.setColumnVisible("SuppDetailsGrid", "1", false);
				iform.setColumnVisible("SuppDetailsGrid", "2", false);
				iform.setColumnVisible("SuppDetailsGrid", "3", false);
				iform.setColumnVisible("SuppDetailsGrid", "7", false);
				iform.setColumnVisible("SuppDetailsGrid", "8", false);
				iform.setColumnVisible("SuppDetailsGrid", "9", false);
				iform.setColumnVisible("SuppDetailsGrid", "10", false);
				iform.setColumnVisible("SuppDetailsGrid", "11", false);
				iform.setColumnVisible("SuppDetailsGrid", "12", false);
				iform.setColumnVisible("SuppDetailsGrid", "13", false);
				iform.setColumnVisible("SuppDetailsGrid", "14", false);
				iform.setColumnVisible("SuppDetailsGrid", "15", false);
				iform.setColumnVisible("SuppDetailsGrid", "16", false);
				iform.setColumnVisible("SuppDetailsGrid", "17", false);
				iform.setColumnVisible("SuppDetailsGrid", "18", false);
				iform.setColumnVisible("SuppDetailsGrid", "19", false);
				iform.setColumnVisible("SuppDetailsGrid", "20", false);
				iform.setColumnVisible("SuppDetailsGrid", "21", false);
				iform.setColumnVisible("SuppDetailsGrid", "22", false);
				iform.setColumnVisible("SuppDetailsGrid", "23", false);
				iform.setColumnVisible("SuppDetailsGrid", "24", false);
				iform.setColumnVisible("SuppDetailsGrid", "25", false);
				iform.setColumnVisible("SuppDetailsGrid", "26", false);
				iform.setColumnVisible("SuppDetailsGrid", "27", false);
				iform.setColumnVisible("SuppDetailsGrid", "28", false);

			}

			else if (Workstep.equalsIgnoreCase("DCC_Experience")) {
				if (decision.equalsIgnoreCase("Rescheduled")) {
					iform.setStyle("DocTypeSection", "visible", "true");
				} else {
					iform.setStyle("DocTypeSection", "visible", "false");
				}
				// generated document list
				List<List<String>> twoDarray2 = iform.getDataFromDB(
						"select genrateddocumentlist from NG_DCC_EXTTABLE with (NOLOCK)  where Wi_Name ='"
								+ processInstanceID + "'");
				Digital_CC.mLogger.debug("twoDarray2: " + twoDarray2);
				String genratedDocList = twoDarray2.get(0).get(0).replaceAll(",", "\n");
				Digital_CC.mLogger.debug("genratedDocList: " + genratedDocList);
				if (!(genratedDocList == null || "".equalsIgnoreCase(genratedDocList))) {
					iform.setValue("textarea19", genratedDocList);
				}
				// added by gaurav
				// sections
				iform.setStyle("DCC_PersonalDetails", "visible", "false");
				iform.setStyle("DCC_EmploymentDetails", "visible", "false");
				iform.setStyle("DCC_BankingDetails", "visible", "false");
				iform.setStyle("DCC_RunPolicy", "visible", "false");
				iform.setStyle("DCC_SuppCardDetails", "visible", "false");
				iform.setStyle("Additional_Documents_Required", "visible", "false");
				iform.setStyle("DCC_AECB_Exposure", "visible", "false");
				iform.setStyle("DCC_LiabilityAddition", "visible", "false");
				iform.setStyle("DCC_AECBPipelines", "visible", "false");
				iform.setStyle("DCC_AdditionofChecque", "visible", "false");
				iform.setStyle("CustomerCallHistory", "visible", "true");
				iform.setStyle("CustomerCallHistory", "disable", "false");
				// free fields
				iform.setStyle("Final_Limit", "visible", "true");
				iform.setStyle("Virtual_Card_Limit", "visible", "true");
				iform.setStyle("Card_Number", "visible", "true");
				iform.setStyle("ECRN", "visible", "true");
				iform.setStyle("CRN", "visible", "true");
				iform.setStyle("Dectech_Decision", "visible", "false");
				iform.setStyle("delegation_authority", "visible", "false");
				iform.setStyle("Non_STP_reason", "visible", "false");
				iform.setStyle("Aecb_score", "visible", "false");
				iform.setStyle("Score_range", "visible", "false");
				iform.setStyle("deviation_description", "visible", "false");
				iform.setStyle("Underwriting_decision", "visible", "false");
				iform.setStyle("bureau_reference_number", "visible", "false");
				iform.setStyle("Expense1", "visible", "false");
				iform.setStyle("Expense2", "visible", "false");
				iform.setStyle("Expense3", "visible", "false");
				iform.setStyle("Expense4", "visible", "false");
				iform.setStyle("Expense5", "visible", "false");
				iform.setStyle("Expense6", "visible", "false");
				iform.setStyle("Credit_Shield_Flag", "visible", "false");
				iform.setStyle("RAK_Protect_Flag", "visible", "false");
				iform.setStyle("Self_Supp_Card_Limit", "visible", "false");
				iform.setStyle("Dependents", "visible", "false");
				iform.setStyle("textarea19", "visible", "true");
				// Supp Card Details Grid
				iform.setColumnVisible("SuppDetailsGrid", "1", false);
				iform.setColumnVisible("SuppDetailsGrid", "2", false);
				iform.setColumnVisible("SuppDetailsGrid", "3", false);
				iform.setColumnVisible("SuppDetailsGrid", "7", false);
				iform.setColumnVisible("SuppDetailsGrid", "8", false);
				iform.setColumnVisible("SuppDetailsGrid", "9", false);
				iform.setColumnVisible("SuppDetailsGrid", "10", false);
				iform.setColumnVisible("SuppDetailsGrid", "11", false);
				iform.setColumnVisible("SuppDetailsGrid", "12", false);
				iform.setColumnVisible("SuppDetailsGrid", "13", false);
				iform.setColumnVisible("SuppDetailsGrid", "14", false);
				iform.setColumnVisible("SuppDetailsGrid", "15", false);
				iform.setColumnVisible("SuppDetailsGrid", "16", false);
				iform.setColumnVisible("SuppDetailsGrid", "17", false);
				iform.setColumnVisible("SuppDetailsGrid", "18", false);
				iform.setColumnVisible("SuppDetailsGrid", "19", false);
				iform.setColumnVisible("SuppDetailsGrid", "20", false);
				iform.setColumnVisible("SuppDetailsGrid", "21", false);
				iform.setColumnVisible("SuppDetailsGrid", "22", false);
				iform.setColumnVisible("SuppDetailsGrid", "23", false);
				iform.setColumnVisible("SuppDetailsGrid", "24", false);
				iform.setColumnVisible("SuppDetailsGrid", "25", false);
				iform.setColumnVisible("SuppDetailsGrid", "26", false);
				iform.setColumnVisible("SuppDetailsGrid", "27", false);
				iform.setColumnVisible("SuppDetailsGrid", "28", false);
				//customercallHistory grid field
				iform.setColumnDisable("CustomerCallHistory", "2", true);
				iform.setStyle("CustomerCallHistory_user", "disable", "true");
				

			} else if (Workstep.equalsIgnoreCase("Firco")) {
				// added by gaurav
				// sections
				iform.setStyle("DCC_PersonalDetails", "visible", "false");
				iform.setStyle("DCC_EmploymentDetails", "visible", "false");
				iform.setStyle("DCC_BankingDetails", "visible", "false");
				iform.setStyle("DCC_RunPolicy", "visible", "false");
				iform.setStyle("DCC_SuppCardDetails", "visible", "false");
				iform.setStyle("DCC_AECB_Exposure", "visible", "false");
				iform.setStyle("DCC_LiabilityAddition", "visible", "false");
				iform.setStyle("DCC_AECBPipelines", "visible", "false");
				iform.setStyle("DCC_AdditionofChecque", "visible", "false");
				iform.setStyle("DocTypeSection", "visible", "false");
				// decision section fields
				iform.setStyle("Dectech_Decision", "visible", "false");
				iform.setStyle("delegation_authority", "visible", "false");
				iform.setStyle("Non_STP_reason", "visible", "false");
				iform.setStyle("Aecb_score", "visible", "false");
				iform.setStyle("Score_range", "visible", "false");
				iform.setStyle("deviation_description", "visible", "false");
				iform.setStyle("Underwriting_decision", "visible", "false");
				iform.setStyle("bureau_reference_number", "visible", "false");
			}

		}

		return strReturn;
	}
}
